<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register Citizen â€¢ NDI Portal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="indexstyle.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg shadow-sm py-3">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">National Digital Identity Portal</a>
        <div class="ms-auto d-flex gap-2">
          <a class="btn btn-outline-primary btn-sm" href="index.html">Home</a>
        </div>
      </div>
    </nav>

    <header class="hero text-center">
      <div class="container">
        <p class="text-uppercase text-white-50 mb-2">Registration</p>
        <h1 class="fw-semibold">Register a New Citizen</h1>
        <p class="mb-0">Fill the form below to add a new registered citizen to the system.</p>
      </div>
    </header>

    <main class="py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="card p-4">
              <form id="registerForm" class="row g-3" data-endpoint="/api/citizens/register">
                <div class="col-md-6">
                  <label class="form-label">First Name</label>
                  <input type="text" class="form-control" name="FirstName" value="test1" required />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Last Name</label>
                  <input type="text" class="form-control" name="LastName" value="test1" required />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Date Of Birth</label>
                  <input type="date" class="form-control" name="DoB" value="2000-12-12" required />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" value="test1@test1.com" name="Email" />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Phone</label>
                  <input type="tel" class="form-control" value="1234567489" name="Phone" />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Occupation</label>
                  <input type="text" class="form-control" value="test1" name="Occupation" />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Nationality</label>
                  <input type="text" class="form-control" value="test1" name="Nationality" />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Blood Group</label>
                  <select class="form-select" value="test1" name="Blood_Group">
                    <option value="">Select</option>
                    <option>A+</option>
                    <option>A-</option>
                    <option>B+</option>
                    <option>B-</option>
                    <option>O+</option>
                    <option>O-</option>
                    <option>AB+</option>
                    <option>AB-</option>
                  </select>
                </div>

                <div class="col-12 d-flex gap-2">
                  <button type="submit" class="btn btn-primary">Register Citizen</button>
                  <a href="index.html" class="btn btn-outline-secondary">Cancel</a>
                </div>
              </form>

              <div id="alertAreaRegister" class="mt-3"></div>

              <!-- Success modal shown after successful registration -->
              <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Registration Successful</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p id="modalMessage">Your account was registered successfully.</p>
                      <p><strong>NID:</strong> <span id="modalNID"></span></p>
                    </div>
                    <div class="modal-footer">
                      <button id="copyNidBtn" type="button" class="btn btn-secondary">Copy NID</button>
                      <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-3gJwYp4Z3+4oa4rYJDc6Xk9FfuH6Yz9EM8mL0Q5rx1w=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registerForm');
        const alertArea = document.getElementById('alertAreaRegister');
        
        if (!form) {
          console.error('Form not found!');
          return;
        }
        
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          console.log('Form submitted');
          
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          console.log('Submitting data:', data);
          alertArea.innerHTML = '<div class="alert alert-info" role="alert">Submitting...</div>';
          
          fetch('http://localhost:3000/api/citizens/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams(data)
          })
          .then(resp => resp.json())
          .then(json => {
            console.log('Success:', json);
            if (json && json.success) {
              const msg = 'Registration successful';

              // Build simple full-page success view and replace page content
              const successHtml = `
                <div class="d-flex vh-100 align-items-center justify-content-center bg-light">
                  <div class="text-center p-4">
                    <h1 class="text-success mb-3">Registration successful</h1>
                    <a href="index.html" class="btn btn-primary">Home</a>
                  </div>
                </div>
              `;

              document.body.innerHTML = successHtml;
            } else {
              const err = (json && (json.error || json.message)) || 'Unknown response';
              alertArea.innerHTML = `<div class="alert alert-danger" role="alert">${err}</div>`;
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alertArea.innerHTML = `<div class="alert alert-danger" role="alert">Error: ${error.message}</div>`;
          });
        });
      });
    </script>
    <script>
      // Copy NID button handler
      document.addEventListener('DOMContentLoaded', function () {
        const copyBtn = document.getElementById('copyNidBtn');
        if (!copyBtn) return;
        copyBtn.addEventListener('click', function () {
          const nid = document.getElementById('modalNID').textContent || '';
          if (!nid) return;
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(nid).then(function () {
              copyBtn.textContent = 'Copied';
              setTimeout(function () { copyBtn.textContent = 'Copy NID'; }, 2000);
            }).catch(function () {
              copyBtn.textContent = 'Copy failed';
              setTimeout(function () { copyBtn.textContent = 'Copy NID'; }, 2000);
            });
          } else {
            // fallback copy method
            const textarea = document.createElement('textarea');
            textarea.value = nid;
            document.body.appendChild(textarea);
            textarea.select();
            try { document.execCommand('copy'); copyBtn.textContent = 'Copied'; }
            catch (e) { copyBtn.textContent = 'Copy failed'; }
            document.body.removeChild(textarea);
            setTimeout(function () { copyBtn.textContent = 'Copy NID'; }, 2000);
          }
        });
      });
    </script>
  </body>
</html>
